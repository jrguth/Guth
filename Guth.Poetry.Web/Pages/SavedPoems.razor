@page "/saved"

<MudText Typo="Typo.h3">Saved Poems</MudText>
<MudGrid>
@foreach(PoemTitle poem in _savedPoems)
{
    <MudItem xs="6">
        <MudCard Elevation="12">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudLink Href="@($"/titles/{poem.Title}")">@poem.Title</MudLink>
                    <MudLink Href="@($"/authors/{poem.Author.Name}")">@poem.Author.Name</MudLink>
                </CardHeaderContent>
            </MudCardHeader>
        </MudCard>
    </MudItem>
}
</MudGrid>


@code {
    [Inject] public IDbContextFactory<PoetryContext> ContextFactory { get; set; }

    private IEnumerable<PoemTitle> _savedPoems = Enumerable.Empty<PoemTitle>();

    protected override async Task OnInitializedAsync()
    {
        using (var context = ContextFactory.CreateDbContext())
        {
            _savedPoems = await context.Titles
                .Include(t => t.Author)
                .ToListAsync();
        }
    }
}
